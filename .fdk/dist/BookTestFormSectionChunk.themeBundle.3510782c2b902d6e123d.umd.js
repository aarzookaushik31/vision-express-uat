function isRunningOnClient(){return"undefined"!=typeof window&&globalThis===window}isRunningOnClient()||(globalThis.queueMicrotask||(globalThis.queueMicrotask=function(e){Promise.resolve().then(e)}),globalThis.Response||(globalThis.Response=class{constructor(){}static error(){return{}}static json(){return"{}"}static redirect(){return{}}})),(Object("undefined"!=typeof self?self:this).webpackChunkthemeBundle=Object("undefined"!=typeof self?self:this).webpackChunkthemeBundle||[]).push([[5942],{30578:(e,t,s)=>{s.d(t,{A:()=>o,M:()=>n});const n="query support($slug: String!) {\n  support {\n    custom_form(slug: $slug) {\n      id\n      application_id\n      description\n      header_image\n      inputs\n      login_required\n      should_notify\n      slug\n      success_message\n      title\n    }\n  }\n}",o="mutation SubmitCustomForm($slug: String!, $customFormSubmissionPayloadInput: CustomFormSubmissionPayloadInput!) {\n    submitCustomForm(slug: $slug, customFormSubmissionPayloadInput: $customFormSubmissionPayloadInput) {\n      message\n      ticket {\n        category {\n          display\n        }\n      }\n    }\n  }\n"},45636:(e,t,s)=>{s.r(t),s.d(t,{Component:()=>m,default:()=>p,getLocateUsStoreAPI:()=>u,settings:()=>y});var n=s(4883),o=s.n(n),a=s(71605),r=s(78140),c=s(48447),i=s(30578);const l=`${window.location.origin}`,u=async()=>{try{const e=`${l}/ext/store-locator/v1.0/getStores?perPage=500`,t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch stores");return await t.json()}catch(e){return console.error("API error:",e),null}};function m({props:e={}}){const[t,s]=(0,n.useState)({}),[l,m]=(0,n.useState)(!0),[y,p]=(0,n.useState)(null),[d,f]=(0,n.useState)(!1),[k,g]=(0,n.useState)({}),[h,b]=(0,n.useState)({}),[E,_]=(0,n.useState)([]),[w,S]=(0,n.useState)(!1),v=(0,n.useRef)(null),{image:A,imageTitle:T}=e,N="book-an-eye-test";(0,n.useEffect)(()=>{(async()=>{try{const e={slug:N},t=await fpi.executeGQL(i.M,e);if(t?.data?.support){const e=t.data.support.custom_form;s(e);const n={},o={};e.inputs.forEach(e=>{n[e.key]="checkbox"!==e.type&&"",o[e.key]=""}),g(n),b(o)}else p("Fields not found")}catch(e){p(e)}finally{m(!1)}})()},[N]),(0,n.useEffect)(()=>{(async()=>{try{const e=await u(),t=e?.data?.items||e?.data||[];if(t.length){console.log("✅ Stores fetched:",t),_(t);const e=[...new Set(t.map(e=>e.store_state).filter(Boolean))];s(t=>{if(!t?.inputs)return t;const s=t.inputs.map(t=>"state"===t.key||"store-state"===t.key?{...t,enum:e.map(e=>({key:e,display:e}))}:t);return{...t,inputs:s}})}else console.warn("⚠️ No stores returned from API")}catch(e){console.error("❌ Error fetching stores:",e)}})()},[]),(0,n.useEffect)(()=>{if(!E.length)return;const e=k.state?[...new Set(E.filter(e=>e.store_state===k.state).map(e=>e.store_city).filter(Boolean))]:[];s(t=>{if(!t.inputs)return t;const s=t.inputs.map(t=>"city"===t.key?{...t,enum:e.map(e=>({key:e,display:e}))}:t);return{...t,inputs:s}}),g(e=>({...e,city:"",store:""}))},[k.state,E]),(0,n.useEffect)(()=>{if(!E.length)return;const e=k.city?[...new Set(E.filter(e=>e.store_city===k.city).map(e=>e.store_name).filter(Boolean))]:[];s(t=>{if(!t.inputs)return t;const s=t.inputs.map(t=>"store"===t.key||"store-name"===t.key||"choose-store"===t.key?{...t,enum:e.map(e=>({key:e,display:e}))}:t);return{...t,inputs:s}}),g(e=>({...e,store:""}))},[k.city,E]),(0,n.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("storeCode");e&&(v.current=e.trim())},[]),(0,n.useEffect)(()=>{if(!E.length)return;const e=[...new Set(E.map(e=>e.store_state).filter(Boolean))];s(t=>{if(!t?.inputs)return t;const s=t.inputs.map(t=>"state"===t.key||"store-state"===t.key?{...t,enum:e.map(e=>({key:e,display:e}))}:t);return{...t,inputs:s}});const t=v.current;if(!t)return;const n=E.find(e=>e.store_code?.toLowerCase()===t.toLowerCase());if(!n)return console.warn("❌ No store found for code:",t);v.current=n,g(e=>({...e,state:n.store_state||""}))},[E]),(0,n.useEffect)(()=>{if(!E.length||!t?.inputs)return;const e=new URLSearchParams(window.location.search).get("storeCode"),n=[...new Set(E.map(e=>e.store_state).filter(Boolean))],o=k.state,a=o?[...new Set(E.filter(e=>e.store_state===o).map(e=>e.store_city).filter(Boolean))]:[],r=k.city,c=r?E.filter(e=>e.store_state===o&&e.store_city===r).map(e=>({key:e.store_name,display:e.store_name})):[];if(e){const t=E.find(t=>t.store_code?.toLowerCase()===e.toLowerCase());t&&(g(e=>({...e,state:t.store_state||"",city:t.store_city||"",store:t.store_name||"","store-name":t.store_name||"","choose-store":t.store_name||""})),S(!0))}s(e=>{if(!e?.inputs)return e;const t=e.inputs.map(e=>"state"===e.key||"store-state"===e.key?{...e,enum:n.map(e=>({key:e,display:e}))}:"city"===e.key||"store-city"===e.key?{...e,enum:a.map(e=>({key:e,display:e}))}:"store"===e.key||"store-name"===e.key?{...e,enum:c}:e);return{...e,inputs:t}})},[E,k.state,k.city]);const C=e=>{const{name:t,value:s,type:n,checked:o}=e.target;g(e=>{const a={...e,[t]:"checkbox"===n?o:s};return"state"===t&&(a.city="",a.store="",S(!1)),"city"===t&&(a.store="",S(!1)),a})};return l?o().createElement("div",null,"Loading..."):y?o().createElement("div",null,"Error: ",String(y)):o().createElement("div",{className:a.A.booktest_container},o().createElement("div",{className:a.A.breadcrumbs},o().createElement("a",{href:"/"},"Home /")," Book an Eye Test"),o().createElement("div",{className:a.A.bookTestTabs},o().createElement("div",{className:a.A.activeTab},"Book An Eye Test - IN STORE"),o().createElement("div",null,o().createElement("a",{href:"/sections/book-an-eye-test-home"},"HOME EYE TEST APPOINTMENT"))),o().createElement("div",{className:a.A.booktest_content},A?.value&&o().createElement("div",{className:a.A.image_section},o().createElement("img",{src:A.value,alt:"Book Test"}),o().createElement("div",{className:a.A.textOverImage},T?.value&&o().createElement("h2",null,T.value))),o().createElement("div",{className:`${a.A.form_section} ${d?a.A.successBackground:""}`},d?o().createElement("div",{className:a.A.success_wrapper},o().createElement("span",{className:a.A.closeSuccessButton,onClick:()=>{f(!1)}},o().createElement(c.A,{className:a.A.closeIcon})),o().createElement("img",{src:r}),o().createElement("h2",{className:a.A.success_message},"You're All Set for Your Eye Test!"),o().createElement("p",null,"Thank you for booking your in-store eye test with Vision Express. ",o().createElement("br",null),o().createElement("br",null),"Our certified optometrists will be ready for you at your scheduled time. Expect a confirmation message with all details shortly."),o().createElement("a",{href:"/products"},"Explore Products")):o().createElement("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{let e=!0;const t={...h},s=new Date;return Object.keys(k).forEach(n=>{const o=k[n];"full-name"!==n||/^[A-Za-z\s]+$/.test(o)?"contact-number"!==n||/^\d{10}$/.test(o)&&!/^(\d)\1{9}$/.test(o)?"email"!==n||/^\S+@\S+\.\S+$/.test(o)?"date"===n&&new Date(o)<s&&(t[n]="Date cannot be in the past",e=!1):(t[n]="Enter a valid email address",e=!1):(t[n]="Enter a valid 10 digit mobile number",e=!1):(t[n]="Only letters and spaces allowed",e=!1)}),b(t),e})())return;const s=t.inputs.map(e=>{const t=k[e.key];if(["state","city","store","store-name","choose-store"].includes(e.key))return{key:e.key,value:t||""};if("dropdown"===e.type){const s=e.enum?.find(e=>e.display===t||e.key===t);return{key:e.key,value:s?.key||t||""}}return"checkbox"===e.type?{key:e.key,value:t?e.enum?.[0]?.key||"yes":""}:{key:e.key,value:t}}),n={slug:N,customFormSubmissionPayloadInput:{response:s}};try{await fpi.executeGQL(i.A,n);const e=E.find(e=>e.store_name===k.store||e.store_name===k["store-name"]||e.store_name===k["choose-store"])||null;console.log(e);const t=e?.email_address||"";console.log(t),f(!0);const s={};Object.keys(k).forEach(e=>s[e]="privacy_policy"!==e&&""),g(s)}catch(e){console.error("Form submission error:",e)}}},t.inputs.map(e=>{const t=["state","city","store","store-name","choose-store"].includes(e.key);return o().createElement("div",{className:a.A.fgroup,key:e.key},"checkbox"!==e.type&&o().createElement("label",null,e.display),"date"===e.key?o().createElement("input",{type:"date",name:e.key,value:k[e.key],onChange:C,min:(new Date).toISOString().split("T")[0],required:e.required}):"dropdown"===e.type||t?o().createElement("select",{name:e.key,value:k[e.key],onChange:C,required:e.required},o().createElement("option",{value:""},"Select ",e.display),e.enum?.map((e,t)=>o().createElement("option",{key:e.key||t,value:e.display||e.key},e.display||e.key))):"text"===e.type||"email"===e.type||"number"===e.type?o().createElement("input",{type:"contact-number"===e.key?"tel":e.type,name:e.key,value:k[e.key],onChange:C,placeholder:e.placeholder,required:e.required}):"checkbox"===e.type?o().createElement("label",{className:a.A.checkbox_label},o().createElement("input",{type:"checkbox",name:e.key,checked:k[e.key]||!1,onChange:C,required:e.required}),e.display):null,h[e.key]&&o().createElement("span",{className:a.A.error_message},h[e.key]))}),o().createElement("div",{className:a.A.sgroup},o().createElement("input",{className:a.A.submit_btn,type:"submit",value:"Submit"}))))))}const y={label:"Book Test Form",props:[{type:"image_picker",id:"image",label:"Right Side Image"},{type:"text",id:"imageTitle",label:"Title on Image",default:"Book an Eye Test"}]};m.settings=y;const p=m},71605:(e,t,s)=>{s.d(t,{A:()=>n});const n={booktest_container:"F1VAf",breadcrumbs:"mMVst",bookTestTabs:"Oc7ef",activeTab:"Pyi5i",form_title:"SJV0W",booktest_content:"F2XH1",image_section:"vErR2",textOverImage:"y6_4W",form_section:"tLPyc",successBackground:"ZkMlu",fgroup:"hhGVR",checkbox_label:"VCl_t",error_message:"MS4jn",sgroup:"AgRvz",submit_btn:"DmIqO",success_wrapper:"OcldW",closeSuccessButton:"B5Joa"}},78140:e=>{e.exports="https://cdn.fynd.com/v2/falling-surf-7c8bb8/fyprod/wrkr/organization/687f0bb35ece7c51f1986525/theme/assets/f11bb759c380555f28fa.png"}}]);